<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Setting Up Actions Major Caveat!!! At the time of this writing there was a&amp;hellip; major inconvenience.
Basically, there are some restrictions that prevent Github actions from being able to publish GitHub Pages. To work around this I had to monkey around different git configurations. The fact that my site uses submodules made it even more cumbersome. Nonetheless, it worked and here is how I did it.
Step 1. Configure a deployment key There are other multiple options for providing the GitHub action authorization." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://why.jromero.codes/post/migrating-to-github/github-actions/" />


    <title>
        
            GitHub Actions for GitHub Pages :: Javier Romero  ‚Äî A simple theme for Hugo
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css">




<meta itemprop="name" content="GitHub Actions for GitHub Pages">
<meta itemprop="description" content="Setting Up Actions Major Caveat!!! At the time of this writing there was a&hellip; major inconvenience.
Basically, there are some restrictions that prevent Github actions from being able to publish GitHub Pages. To work around this I had to monkey around different git configurations. The fact that my site uses submodules made it even more cumbersome. Nonetheless, it worked and here is how I did it.
Step 1. Configure a deployment key There are other multiple options for providing the GitHub action authorization.">
<meta itemprop="datePublished" content="2020-02-05T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-02-05T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="334">
<meta itemprop="image" content="https://why.jromero.codes/"/>



<meta itemprop="keywords" content="github,github-actions," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://why.jromero.codes/"/>

<meta name="twitter:title" content="GitHub Actions for GitHub Pages"/>
<meta name="twitter:description" content="Setting Up Actions Major Caveat!!! At the time of this writing there was a&hellip; major inconvenience.
Basically, there are some restrictions that prevent Github actions from being able to publish GitHub Pages. To work around this I had to monkey around different git configurations. The fact that my site uses submodules made it even more cumbersome. Nonetheless, it worked and here is how I did it.
Step 1. Configure a deployment key There are other multiple options for providing the GitHub action authorization."/>





    <meta property="article:published_time" content="2020-02-05 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">cd /home/jromero</span>
            <span class="logo__cursor" style=""></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://why.jromero.codes/post/">blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://why.jromero.codes/post/migrating-to-github/github-actions/">GitHub Actions for GitHub Pages</a></h2>

            

            <div class="post-content">
                <h3 id="setting-up-actions">Setting Up Actions</h3>
<h4 id="major-caveat">Major Caveat!!!</h4>
<p>At the time of this writing there was a&hellip; <a href="https://github.community/t5/GitHub-Actions/Github-action-not-triggering-gh-pages-upon-push/m-p/26869/highlight/true#M301">major inconvenience</a>.</p>
<p>Basically, there are some restrictions that prevent Github actions from being able to publish GitHub Pages. To work
around this I had to monkey around different git configurations. The fact that my site uses submodules made it even
more cumbersome. Nonetheless, it worked and here is how I did it.</p>
<h3 id="step-1-configure-a-deployment-key">Step 1. Configure a deployment key</h3>
<p>There are other <a href="https://github.com/JamesIves/github-pages-deploy-action#configuration-">multiple options</a> for providing
the GitHub action authorization. I chose this route as the most restrictive given the constraint mentioned above.</p>
<p>To setup a deployment key simply <a href="https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys">follow the guide</a>
to create and install a deployment key.</p>
<h3 id="step-2-setup-a-workflow">Step 2. Setup a workflow</h3>
<p>Go to your project and find the <strong>Actions</strong> tab:</p>

    <figure class="left" >
        <img src="../img/actions-tab.png"   style="width: 200px"  />

        
    </figure>


<p>Then, click on <strong>Set up a workflow yourself</strong>:</p>

    <figure class="left" >
        <img src="../img/setup-workflow.png"   style="width: 300px"  />

        
    </figure>


<p>The workflow I ended up with that works with submodules is the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">name: Build and Deploy

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Checkout submodules
        shell: bash
        run: <span style="color:#e6db74">|
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">         </span><span style="color:#e6db74"> </span><span style="color:#e6db74"># NOTE: the deploy key below is per repo so it wouldn&#39;t work for the necessary submodules.</span>
          <span style="color:#75715e"># NOTE: this works because the submodules are public.</span>
          git config --global url.<span style="color:#e6db74">&#34;https://github.com/&#34;</span>.insteadOf <span style="color:#e6db74">&#34;git@github.com:&#34;</span>

          git submodule sync --recursive
          git submodule update --init --force --recursive --depth=<span style="color:#ae81ff">1</span>

          <span style="color:#75715e"># NOTE: we need to revert this because the &#34;Deploy&#34; step needs to use ssh</span>
          git config --global --unset-all url.<span style="color:#e6db74">&#34;https://github.com/&#34;</span>.insteadof
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2<span style="color:#ae81ff">.4</span><span style="color:#ae81ff">.1</span>
        with:
          hugo-version: <span style="color:#e6db74">&#39;0.62.2&#39;</span>
          extended: <span style="color:#66d9ef">true</span>
      - name: Hugo build
        run: hugo
      - name: Install SSH Client
        uses: webfactory/ssh-agent@v0<span style="color:#ae81ff">.2</span><span style="color:#ae81ff">.0</span>
        with:
          ssh-private-key: ${{ secrets.DEPLOY_PRIVATE_KEY }}
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          SSH: <span style="color:#66d9ef">true</span>
          BRANCH: gh-pages
          FOLDER: public
</code></pre></div><p>As you can see, my hopeful build and deploy strategy becomes some fancy gymnastics just to get everything
playing well together. The hope is that soon in the future it will be. üôè</p>
<h3 id="step-3-commit-and-push">Step 3. Commit and Push</h3>
<p>After a quick commit and push, we can now see the pipeline in action by going back to the <strong>Actions</strong> tab.</p>

    <figure class="left" >
        <img src="../img/actions-result.png"   style="max-width: 100%; width: 700px;"  />

        
    </figure>



            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://why.jromero.codes/tags/github">github</a></span><span class="tag"><a href="https://why.jromero.codes/tags/github-actions">github-actions</a></span>
  				</p>
  			</div>

        
          <div id="comments" class="thin">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "why-jromero-codes" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span>Javier Romero</span>
            <span> <a href="https://why.jromero.codes/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
